var map,snake,food,timer,initSpeed=200,grade=0,flag=1,isBegin=!1;function Map(){this.width=800,this.height=400,this.position="relative",this._map=null,this.map1=null,this.show=function(){this._map=document.createElement("div"),this.map1=document.createElement("div"),this.map1.style.width="946px",this.map1.style.height="501px",this.map1.style.backgroundImage="url(images/map.jpg)",this._map.style.position="absolute",this._map.style.width=this.width+"px",this._map.style.height=this.height+"px",this._map.style.top="50px",this._map.style.left="73px",this.map1.style.position=this.position,this.map1.style.margin="0 auto",document.body.appendChild(this.map1),this.map1.appendChild(this._map)},this.highScore=function(){localStorage.score?highScore.innerHTML="最高分："+localStorage.score:(localStorage.score=0,highScore.innerHTML="最高分："+localStorage.score)}}function Food(){this.width=20,this.height=20,this.position="absolute",this.background="url(images/body2.png)",this.x=0,this.y=0,this._food,this.show=function(){this._food=document.createElement("div"),this._food.style.width=this.width+"px",this._food.style.height=this.height+"px",this._food.style.position=this.position,this._food.style.background=this.background,this.x=Math.floor(Math.random()*map.width/this.width),this.y=Math.floor(Math.random()*map.height/this.width),arrx=[],arry=[];for(var t=0;t<snake.body.length;t++)arrx.push(snake.body[t][0]);for(;;){for(t=0;t<arrx.length;t++)arrx[t]==this.x&&arry.push(snake.body[t][1]);if(-1==arry.indexOf(this.y)){this._food.style.left=this.x*this.width,this._food.style.top=this.y*this.height,map._map.appendChild(this._food);break}this.x=Math.floor(Math.random()*map.width/this.width),this.y=Math.floor(Math.random()*map.height/this.width)}}}function Snake(){this.width=20,this.height=20,this.position="absolute",this.direct=null,this.body=new Array([4,2,"url(images/head-right.png)",null],[3,2,"url(images/body1.png)",null],[2,2,"url(images/tail2-right.png)",null],[1,2,"url(images/tail-right.png)",null]),this.show=function(){for(var t=0;t<this.body.length;t++)null==this.body[t][3]&&(this.body[t][3]=document.createElement("div"),this.body[t][3].style.width=this.width,this.body[t][3].style.height=this.height,this.body[t][3].style.position=this.position,this.body[this.body.length-2][2]="url(images/tail2-right.png)",this.body[this.body.length-3][2]="url(images/body1.png)",this.body[t][3].style.background=this.body[t][2],map._map.appendChild(this.body[t][3])),this.body[t][3].style.left=this.body[t][0]*this.width+"px",this.body[t][3].style.top=this.body[t][1]*this.height+"px";this.body[this.body.length-3][3].style.background="url(images/body1.png)",this.body[this.body.length-1][1]<this.body[this.body.length-2][1]&&(this.body[this.body.length-1][3].style.background="url(images/tail-down.png)"),this.body[this.body.length-1][1]==this.body[this.body.length-2][1]&&this.body[this.body.length-1][0]<this.body[this.body.length-2][0]&&(this.body[this.body.length-1][3].style.background="url(images/tail-right.png)"),this.body[this.body.length-1][1]>this.body[this.body.length-2][1]&&(this.body[this.body.length-1][3].style.background="url(images/tail-up.png)"),this.body[this.body.length-1][1]==this.body[this.body.length-2][1]&&this.body[this.body.length-1][0]>this.body[this.body.length-2][0]&&(this.body[this.body.length-1][3].style.background="url(images/tail-left.png)"),this.body[this.body.length-2][1]<this.body[this.body.length-3][1]&&(this.body[this.body.length-2][3].style.background="url(images/tail2-down.png)"),this.body[this.body.length-2][1]==this.body[this.body.length-3][1]&&this.body[this.body.length-1][0]<this.body[this.body.length-2][0]&&(this.body[this.body.length-2][3].style.background="url(images/tail2-right.png)"),this.body[this.body.length-2][1]>this.body[this.body.length-3][1]&&(this.body[this.body.length-2][3].style.background="url(images/tail2-up.png)"),this.body[this.body.length-2][1]==this.body[this.body.length-3][1]&&this.body[this.body.length-1][0]>this.body[this.body.length-2][0]&&(this.body[this.body.length-2][3].style.background="url(images/tail2-left.png)")},this.move=function(){for(var t=this.body.length-1;t>0;t--)this.body[t][0]=this.body[t-1][0],this.body[t][1]=this.body[t-1][1];switch(this.direct){case"right":this.body[0][0]=this.body[0][0]+1,this.body[0][3].style.background="url(images/head-right.png)";break;case"left":this.body[0][0]=this.body[0][0]-1,this.body[0][3].style.background="url(images/head-left.png)";break;case"up":this.body[0][1]=this.body[0][1]-1,this.body[0][3].style.background="url(images/head-up.png)";break;case"down":this.body[0][1]=this.body[0][1]+1,this.body[0][3].style.background="url(images/head-down.png)"}this.condition()},this.speed=function(){timer=setInterval("snake.move()",initSpeed)},this.condition=function(){for(var t=1;t<this.body.length;t++)this.body[0][0]==this.body[t][0]&&this.body[0][1]==this.body[t][1]&&(clearInterval(timer),gameOver.style.display="block",isBegin=!1,score.innerHTML=grade,document.all.sound.src="music/die.mp3",grade>localStorage.score&&(localStorage.score=grade,map.highScore()));if("block"!=getComputedStyle(gameOver).display){if(this.body[0][0]<0||this.body[0][0]>=map.width/this.width||this.body[0][1]<0||this.body[0][1]>=map.height/this.height)return clearInterval(timer),gameOver.style.display="block",isBegin=!1,score.innerHTML=grade,document.all.sound.src="music/die.mp3",void(grade>localStorage.score&&(localStorage.score=grade,map.highScore()));if(this.show(),this.body[0][0]==food.x&&this.body[0][1]==food.y){document.all.sound.src="music/eat.mp3",grade++,this.body.push([-20,-20,"url(images/tail-right.png)",null]),map._map.removeChild(food._food),food.show();var e=h2.getElementsByTagName("span");for(t=0;t<e.length;t++){e[t].offsetTop;-27==e[t].offsetTop&&(e[t].style.transition="0s",e[t].style.top="27px"),e[t].offsetTop>0?(e[t].innerHTML=grade,e[t].style.transition="1.2s",e[t].style.top=0):e[t].offsetTop>-27&&(e[t].style.transition="1.2s",e[t].style.top="-27px")}grade%5==0&&(document.all.sound.src="music/pass.mp3",clearInterval(timer),initSpeed-=20,flag++,timer=setInterval("snake.move()",initSpeed),pass.innerHTML=flag,setTimeout(function(){pass.style.color="blue",pass.style.transform="scale(1.2)"},150),setTimeout(function(){pass.style.color="green",pass.style.transform="scale(1.4)"},300),setTimeout(function(){pass.style.color="yellow",pass.style.transform="scale(1.6)"},450),setTimeout(function(){pass.style.color="blue",pass.style.transform="scale(1.4)"},600),setTimeout(function(){pass.style.color="green",pass.style.transform="scale(1.2)"},750),setTimeout(function(){pass.style.color="#DF130A",pass.style.transform="scale(1)"},900))}}else clearInterval(timer)}}document.onkeydown=function(t){if("none"==getComputedStyle(gameStart).display&&"none"==getComputedStyle(gameOver).display&&13==t.keyCode&&(0==isBegin?(null==snake.direct&&(snake.direct="right",snake.speed()),null==timer&&(timer=setInterval("snake.move()",initSpeed),document.title="贪吃蛇",paused.style.display="none"),isBegin=!0):(clearInterval(timer),timer=null,isBegin=!1,document.title="贪吃蛇-暂停中···",paused.style.display="block")),1==isBegin)switch(t.keyCode){case 38:snake.direct=snake.body[0][0]==snake.body[1][0]?snake.direct:"up","down"!=snake.direct&&(snake.move(),clearInterval(timer),timer=setInterval("snake.move()",initSpeed));break;case 40:snake.direct=snake.body[0][0]==snake.body[1][0]?snake.direct:"down","up"!=snake.direct&&(snake.move(),clearInterval(timer),timer=setInterval("snake.move()",initSpeed));break;case 39:snake.direct=snake.body[0][1]==snake.body[1][1]?snake.direct:"right","left"!=snake.direct&&(snake.move(),clearInterval(timer),timer=setInterval("snake.move()",initSpeed));break;case 37:snake.direct=snake.body[0][1]==snake.body[1][1]?snake.direct:"left","right"!=snake.direct&&(snake.move(),clearInterval(timer),timer=setInterval("snake.move()",initSpeed))}},window.onload=function(){(map=new Map).show(),map.highScore(),(snake=new Snake).show(),(food=new Food).show()};